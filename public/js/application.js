!function(){"use strict";function e(e,t){var a={};return a}angular.module("AppService",["ngRoute"]).factory("AppService",e),e.$inject=["$location","$window"]}(),function(){"use strict";function e(e,t,a,n){var i={};return i.logout=function(){n.setToken(),a.path("/")},i.isLoggedIn=function(){return n.getToken()?!0:!1},i.getUser=function(){return n.getToken()?e.get("/api/me"):t.reject({message:"User has no token"})},i}function t(e){var t={};return t.getToken=function(){return e.get("token")},t.setToken=function(t){t?e.put("token",t):e.remove("token")},t}function a(e,t,a){var n={};return n.request=function(e){var t=a.getToken();return t&&(e.headers["x-access-token"]=t),e},n.responseError=function(n){return 403==n.status&&(a.setToken(),t.path("/")),e.reject(n)},n}angular.module("AuthService",[]).factory("Auth",e).factory("AuthToken",t).factory("AuthInterceptor",a),e.$inject=["$http","$q","$location","AuthToken"],t.$inject=["$cookies"],a.$inject=["$q","$location","AuthToken"]}(),function(){"use strict";function e(e,t,a){var n=this;n.initialize=function(){a.getUser().then(function(e){e.data.success?n.user=e.data.data:delete n.user,n.isLoggedIn=n.user?!0:!1,console.log("USER : ",n.user)})},n.initialize(),e.$on("$routeChangeStart",n.initialize),n.login=function(){t.location.href="/auth/instagram"},n.logout=function(){console.log("logout"),a.logout(),delete n.user},n.menuStyle="collapse navbar-collapse",n.menuClick=function(){"navbar-collapse"==n.menuStyle?n.menuStyle="collapse navbar-collapse":n.menuStyle="navbar-collapse"}}angular.module("AppController",[]).controller("AppController",e),e.$inject=["$rootScope","$window","Auth"]}(),function(){"use strict";function e(e,t,a,n){var i=this;i.leftPanel="",i.myIgPics=[],i.igPic={},i.closeLeftPanel=function(){i.leftPanel="",document.querySelector("#map").className="map_inactive",document.querySelector("#side").className="side_inactive",setTimeout(function(){google.maps.event.trigger(map,"resize")},1e3)},i.igShowIsRunning=!1,i.igShowDetailToggle=function(){"detail_inactive"==i.igPic.detailClass?(i.igPic.detailClass="detail_active",i.igPic.detailBtnClass="hidden"):(i.igPic.detailClass="detail_inactive",i.igPic.detailBtnClass="btn btn-default btn-detail")},i.formatDate=function(e){var t=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];return(1==e.getHours().toString().length?"0"+e.getHours():e.getHours())+":"+(1==e.getMinutes().toString().length?"0"+e.getMinutes():e.getMinutes())+" "+t[e.getMonth()]+" "+(1==e.getDate().toString().length?"0"+e.getDate():e.getDate())+", "+e.getFullYear()},i.formatDuration=function(e){var t=parseInt(e/1e3),a=0,n=0,i=0,o="";return t>86400&&(a=parseInt(t/86400),t-=86400*a,o+=a+" days "),t>3600&&(n=parseInt(t/3600),t-=3600*n,o+=n+" hours "),t>60&&(i=parseInt(t/60),t-=60*i,o+=i+" mins "),o+=t+" secs"},i.igShow=function(e){if(!i.igShowIsRunning){i.igShowIsRunning=!0,i.igPic.balloon=e;var a=Date.now();i.igPic.created_at=i.formatDate(new Date(i.igPic.balloon.data.created_at)),i.igPic.arrived_at=i.formatDate(new Date(i.igPic.balloon.data.arrived_at)),e.data.arrived_at>a?(i.igPic.status="Flying to",i.igPic.arrived=!1,i.igPic.travelTime=i.formatDuration(a-i.igPic.balloon.data.created_at)):(i.igPic.status="Arrived at",i.igPic.arrived=!0,i.igPic.travelTime=i.formatDuration(i.igPic.balloon.data.arrived_at-i.igPic.balloon.data.created_at)),i.igPic.detailClass="detail_inactive",i.igPic.detailBtnClass="btn btn-default btn-detail",t.get("api/show_ig",{params:{igid:e.igId}}).success(function(e){e.success?(i.igPic.ig=e.data,i.leftPanel==i.igPic.ig.id?i.closeLeftPanel():"igNew"==i.leftPanel?(i.leftPanel=i.igPic.igId,document.querySelector("ig-show").className="",document.querySelector("ig-new").className="hidden"):(i.leftPanel=i.igPic.ig.id,document.querySelector("ig-show").className="",document.querySelector("ig-new").className="hidden",document.querySelector("#map").className="map_active",document.querySelector("#side").className="side_active"),i.igShowIsRunning=!1):(alert("Something went Wrong, please login again.."),n.logout())}).error(function(e){alert("Something went Wrong, please login again..",e),n.logout()})}},i.igIndex=function(){t.get("api/my_ig").success(function(e){e.success?i.myIgPics=e.data:(alert("Something went Wrong, please login again.."),n.logout())}).error(function(e){alert("Something went Wrong, please login again..",e),n.logout()})},i.igNew=function(){"igNew"==i.leftPanel?i.closeLeftPanel():i.leftPanel?(i.leftPanel="igNew",document.querySelector("ig-show").className="hidden",document.querySelector("ig-new").className="",i.igIndex(),i.startOver()):(i.leftPanel="igNew",document.querySelector("ig-show").className="hidden",document.querySelector("ig-new").className="",document.querySelector("#map").className="map_active",document.querySelector("#side").className="side_active",i.igIndex(),i.startOver())},i.unSelectPic=function(){i.igNewPic=void 0;for(var e=document.querySelectorAll(".my_ig_pic_con_hidden"),t=0;t<e.length;t++)e[t].className="col-xs-4 my_ig_pic_con";var a=document.querySelector(".my_ig_pic_con_selected");a&&(a.className="col-xs-4 my_ig_pic_con")},i.startOver=function(){i.unSelectPic(),i.locationAddress="",i.locationAddressSearchResults="",i.selectedAddress={},i.placeName="",i.placeNameSearchResults="",i.selectedPlaceName={},i.finalDestination.marker&&i.finalDestination.marker.setMap(null),i.finalDestination={},i.igShowDone=!1},i.igNewPic=void 0,i.selectPic=function(e){if(i.igNewPic)i.unSelectPic();else{var t=document.getElementById(e);i.igNewPic={id:e,image:t.dataset.image,link:t.dataset.link};for(var a=document.querySelectorAll(".my_ig_pic_con"),n=0;n<a.length;n++)a[n].className="my_ig_pic_con_hidden";t.className="my_ig_pic_con_selected",i.igShowSelectedPic=e}},i.finalDestination={},i.locationAddress="",i.locationAddressSearchResults="",i.findByAddress=function(){t.get("api/find_location_by_address",{params:{address:i.locationAddress}}).success(function(e){e.success?i.locationAddressSearchResults=e.data:(alert("Something went Wrong, please login again.."),n.logout())}).error(function(e){alert("Something went Wrong, please login again..",e),n.logout()})},i.generateDestinationMarker=function(e,t){var a="<h4>"+e+"</h4>";t&&(a+="<h5>"+t+"</h5>"),i.finalDestination.infowindow=new google.maps.InfoWindow({content:a}),i.finalDestination.marker&&i.finalDestination.marker.setMap(null),i.finalDestination.marker=new google.maps.Marker({position:new google.maps.LatLng(i.finalDestination.lat,i.finalDestination.lng),title:e}),i.finalDestination.marker.setMap(i.map),i.finalDestination.infowindow.open(i.map,i.finalDestination.marker)},i.selectedAddress={},i.selectAddress=function(){i.finalDestination.lat=i.selectedAddress.geometry.location.lat,i.finalDestination.lng=i.selectedAddress.geometry.location.lng,i.generateDestinationMarker(i.selectedAddress.formatted_address),i.selectedAddress.address_components.forEach(function(e){var t=!1;if(e.types.forEach(function(e){"political"==e&&(t=!0)}),!t){var a=i.selectedAddress.formatted_address;a=a.replace(e.long_name,""),a=a.replace(e.short_name,""),i.selectedAddress.formatted_address=a}}),i.selectedAddress.formatted_address=i.selectedAddress.formatted_address.split(",").map(function(e){return e.trim()}).filter(function(e){return""!==e}).join(", "),i.finalDestination.name=i.selectedAddress.formatted_address,google.maps.event.trigger(map,"resize"),i.map.setCenter(new google.maps.LatLng(i.finalDestination.lat,i.finalDestination.lng)),i.map.setZoom(14)},i.placeName="",i.placeNameSearchResults="",i.findByPlaceName=function(){t.get("api/find_location_by_place_name",{params:{lat:i.selectedAddress.geometry.location.lat,lng:i.selectedAddress.geometry.location.lng,placename:i.placeName}}).success(function(e){e.success?i.placeNameSearchResults=e.data.results:(alert("Something went Wrong, please login again.."),n.logout())}).error(function(e){alert("Something went Wrong, please login again..",e),n.logout()})},i.selectedPlaceName={},i.selectPlaceName=function(){i.selectedPlaceName&&(i.finalDestination.lat=i.selectedPlaceName.geometry.location.lat,i.finalDestination.lng=i.selectedPlaceName.geometry.location.lng,i.finalDestination.name=i.selectedPlaceName.name,google.maps.event.trigger(map,"resize"),i.generateDestinationMarker(i.selectedPlaceName.name,i.selectedPlaceName.vicinity),i.map.setCenter(new google.maps.LatLng(i.finalDestination.lat,i.finalDestination.lng)),i.map.setZoom(16))},i.igShowDone=!1,i.confirm=function(){i.finalDestination.marker.setMap(null);var e=i.finalDestination.lat-i.centerLatLng.lat,a=i.finalDestination.lng-i.centerLatLng.lng,o=a>=0?Math.atan(e/a):Math.PI+Math.atan(e/a),r=Math.sin(o),l=Math.cos(o),s=Date.now(),c=parseInt(s+Math.abs(e/r*1e5*1e3)),g={name:i.finalDestination.name,igId:i.igNewPic.id,igImage:i.igNewPic.image,igLink:i.igNewPic.link,lat:i.centerLatLng.lat,lng:i.centerLatLng.lng,endLat:i.finalDestination.lat,endLng:i.finalDestination.lng,latVel:r,lngVel:l,created_at:s,arrived_at:c};t.post("api/balloons",g).success(function(e){e.success?(i.balloons.push(e.data),i.generateMarker(i.balloons[i.balloons.length-1]),i.map.setCenter(new google.maps.LatLng(e.data.lat,e.data.lng)),i.map.setZoom(12),i.igShowDone=!0):(alert("Something went Wrong, please login again.."),n.logout())}).error(function(e){alert("Something went Wrong, please login again..",e),n.logout()})},i.generateMarker=function(e,t){t<e.arrived_at?(e.curLat=e.lat+(e.endLat-e.lat)*(t-e.created_at)/(e.arrived_at-e.created_at),e.curLng=e.lng+(e.endLng-e.lng)*(t-e.created_at)/(e.arrived_at-e.created_at)):(e.curLat=e.endLat,e.curLng=e.endLng);var a=new google.maps.Marker({position:new google.maps.LatLng(e.curLat,e.curLng),title:e.name,igId:e.igId,icon:new google.maps.MarkerImage(e.igImage,null,null,null,new google.maps.Size(50,50))});i.oms.addListener("click",function(e,t){i.igShow(e)}),i.oms.addListener("spiderfy",function(e,t){i.balloons.forEach(function(t){e.forEach(function(e){t.igId==e.igId&&(t.stop=!0)})})}),i.oms.addListener("unspiderfy",function(e,t){i.balloons.forEach(function(t){e.forEach(function(e){t.igId==e.igId&&(t.stop=!1)})})}),i.oms.addMarker(a),e.marker=a,e.marker.data=e,e.marker.setMap(i.map)},i.balloons=[],i.centerLatLng={lat:34.05223,lng:-118.24368},document.querySelector("ig-show").className="hidden",document.querySelector("ig-new").className="hidden";var o=function(e,t,a){var n=new google.maps.StyledMapType([{featureType:"landscape",stylers:[{hue:"#FFBB00"},{saturation:43.400000000000006},{lightness:37.599999999999994},{gamma:1}]},{featureType:"road.highway",stylers:[{hue:"#FFC200"},{saturation:-61.8},{lightness:45.599999999999994},{gamma:1}]},{featureType:"road.arterial",stylers:[{hue:"#FF0300"},{saturation:-100},{lightness:51.19999999999999},{gamma:1}]},{featureType:"road.local",stylers:[{hue:"#FF0300"},{saturation:-100},{lightness:52},{gamma:1}]},{featureType:"water",stylers:[{hue:"#0078FF"},{saturation:-13.200000000000003},{lightness:2.4000000000000057},{gamma:1}]},{featureType:"poi",stylers:[{hue:"#00FF6A"},{saturation:-1.0989010989011234},{lightness:11.200000000000017},{gamma:1}]}],{name:"map_style"}),o={zoom:a,center:new google.maps.LatLng(e,t),mapTypeControlOptions:{mapTypeIds:[google.maps.MapTypeId.ROADMAP,"map_style"]}};i.map=new google.maps.Map(document.getElementById("map"),o),i.map.mapTypes.set("map_style",n),i.map.setMapTypeId("map_style"),i.oms=new OverlappingMarkerSpiderfier(i.map,{circleFootSeparation:46,spiralFootSeparation:52});var r=Date.now();i.balloons.forEach(function(e){i.generateMarker(e,r)}),i.updateBalloons=setInterval(function(){var e=Date.now();i.igPic.arrived===!1&&(i.igPic.travelTime=i.formatDuration(e-i.igPic.balloon.data.created_at),document.querySelector("#liveTravelingTime").innerText=i.igPic.travelTime),i.balloons.forEach(function(t){!t.stop&&e<t.arrived_at&&(t.curLat=t.lat+(t.endLat-t.lat)*(e-t.created_at)/(t.arrived_at-t.created_at),t.curLng=t.lng+(t.endLng-t.lng)*(e-t.created_at)/(t.arrived_at-t.created_at),t.marker.setPosition(new google.maps.LatLng(t.curLat,t.curLng)))})},1e3)};t.get("api/balloons").success(function(e){e.success?(i.balloons=e.data,o(i.centerLatLng.lat,i.centerLatLng.lng,12)):(alert("Something went Wrong, please login again.."),n.logout())}).error(function(e){alert("Something went Wrong, please login again..",e),n.logout()}),e.$on("$destroy",function(){clearInterval(i.updateBalloons)})}angular.module("MapController",[]).controller("MapController",e),e.$inject=["$scope","$http","$window","Auth"]}(),function(){"use strict";function e(){return{restrict:"E",templateUrl:"directives/ig_show.html"}}function t(){return{restrict:"E",templateUrl:"directives/ig_new.html"}}angular.module("MapDirectives",[]).directive("igShow",e).directive("igNew",t)}(),function(){"use strict";function e(e,t){e.when("/",{templateUrl:"views/welcome.html",controller:"AppController",controllerAs:"appCtrl",requireLogin:!1}).when("/app",{templateUrl:"views/app.html",controller:"MapController",controllerAs:"mapCtrl",requireLogin:!0}).otherwise("/"),t.html5Mode(!0)}angular.module("app.routes",["ngRoute"]).config(e),e.$inject=["$routeProvider","$locationProvider"]}(),function(){"use strict";function e(e){e.interceptors.push("AuthInterceptor")}function t(e,t,a,n){e.$on("$locationChangeStart",function(e,i,o){for(var r in t.routes)-1!=i.indexOf(r)&&t.routes[r].requireLogin&&!n.isLoggedIn()&&(alert("Please login first :D"),e.preventDefault(),a.location.href="/")})}angular.module("iBalloon",["app.routes","ngCookies","AppController","MapController","AppService","AuthService","MapDirectives"]).config(e).run(t),e.$inject=["$httpProvider"],t.$inject=["$rootScope","$route","$window","Auth"]}();