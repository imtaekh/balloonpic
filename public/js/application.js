!function(){"use strict";function e(e,t){var n={};return n}angular.module("AppService",["ngRoute"]).factory("AppService",e),e.$inject=["$location","$window"]}(),function(){"use strict";function e(e,t,n,a){var o={};return o.logout=function(){a.setToken(),n.path("/")},o.isLoggedIn=function(){return a.getToken()?!0:!1},o.getUser=function(){return a.getToken()?e.get("/api/me"):t.reject({message:"User has no token"})},o}function t(e){var t={};return t.getToken=function(){return e.get("token")},t.setToken=function(t){t?e.put("token",t):e.remove("token")},t}function n(e,t,n){var a={};return a.request=function(e){var t=n.getToken();return t&&(e.headers["x-access-token"]=t),e},a.responseError=function(a){return 403==a.status&&(n.setToken(),t.path("/")),e.reject(a)},a}angular.module("AuthService",[]).factory("Auth",e).factory("AuthToken",t).factory("AuthInterceptor",n),e.$inject=["$http","$q","$location","AuthToken"],t.$inject=["$cookies"],n.$inject=["$q","$location","AuthToken"]}(),function(){"use strict";function e(e,t,n){var a=this;a.initialize=function(){n.getUser().then(function(e){e.data.success?a.user=e.data.data:delete a.user,a.isLoggedIn=a.user?!0:!1,console.log("USER : ",a.user)})},a.initialize(),e.$on("$routeChangeStart",a.initialize),a.login=function(){t.location.href="/auth/instagram"},a.logout=function(){console.log("logout"),n.logout(),delete a.user},a.menuStyle="collapse navbar-collapse",a.menuClick=function(){"navbar-collapse"==a.menuStyle?a.menuStyle="collapse navbar-collapse":a.menuStyle="navbar-collapse"}}angular.module("AppController",[]).controller("AppController",e),e.$inject=["$rootScope","$window","Auth"]}(),function(){"use strict";function e(e,t,n,a){var o=this;o.leftPanel="",o.myIgPics=[],o.igPic={},o.closeLeftPanel=function(){o.leftPanel="",document.querySelector("#map").className="map_inactive",document.querySelector("#side").className="side_inactive",setTimeout(function(){google.maps.event.trigger(map,"resize")},1e3)},o.igShowIsRunning=!1,o.igShow=function(e){o.igShowIsRunning||(o.igShowIsRunning=!0,o.igPic.balloon=e,t.get("api/show_ig",{params:{igid:e.igId}}).success(function(e){e.success?(o.igPic.ig=e.data,console.log(o.igPic),o.leftPanel==o.igPic.ig.id?o.closeLeftPanel():"igNew"==o.leftPanel?(o.leftPanel=o.igPic.igId,document.querySelector("ig-show").className="",document.querySelector("ig-new").className="hidden"):(o.leftPanel=o.igPic.ig.id,document.querySelector("ig-show").className="",document.querySelector("ig-new").className="hidden",document.querySelector("#map").className="map_active",document.querySelector("#side").className="side_active"),o.igShowIsRunning=!1):(alert("Something went Wrong, please login again.."),a.logout())}).error(function(e){alert("Something went Wrong, please login again..",e),a.logout()}))},o.igIndex=function(){t.get("api/my_ig").success(function(e){e.success?o.myIgPics=e.data:(alert("Something went Wrong, please login again.."),a.logout())}).error(function(e){alert("Something went Wrong, please login again..",e),a.logout()})},o.igNew=function(){"igNew"==o.leftPanel?o.closeLeftPanel():o.leftPanel?(o.leftPanel="igNew",document.querySelector("ig-show").className="hidden",document.querySelector("ig-new").className="",o.igIndex(),o.startOver()):(o.leftPanel="igNew",document.querySelector("ig-show").className="hidden",document.querySelector("ig-new").className="",document.querySelector("#map").className="map_active",document.querySelector("#side").className="side_active",o.igIndex(),o.startOver())},o.unSelectPic=function(){o.igNewPic=void 0;for(var e=document.querySelectorAll(".my_ig_pic_con_hidden"),t=0;t<e.length;t++)e[t].className="col-xs-4 my_ig_pic_con";var n=document.querySelector(".my_ig_pic_con_selected");n&&(n.className="col-xs-4 my_ig_pic_con")},o.startOver=function(){o.unSelectPic(),o.finalLatLng={},o.locationAddress="",o.locationAddressId="",o.locationAddressSearchResults="",o.selectedAddress={},o.placeName="",o.placeNameId="",o.placeNameSearchResults="",o.selectedPlaceName={},o.igShowDone=!1},o.igNewPic=void 0,o.selectPic=function(e){if(o.igNewPic)o.unSelectPic();else{var t=document.getElementById(e);o.igNewPic={id:e,image:t.dataset.image,link:t.dataset.link};for(var n=document.querySelectorAll(".my_ig_pic_con"),a=0;a<n.length;a++)n[a].className="my_ig_pic_con_hidden";t.className="my_ig_pic_con_selected",o.igShowSelectedPic=e}},o.finalLatLng={},o.locationAddress="",o.locationAddressSearchResults="",o.findByAddress=function(){t.get("api/find_location_by_address",{params:{address:o.locationAddress}}).success(function(e){e.success?o.locationAddressSearchResults=e.data:(alert("Something went Wrong, please login again.."),a.logout())}).error(function(e){alert("Something went Wrong, please login again..",e),a.logout()})},o.selectedAddress={},o.selectAddress=function(e){var t=document.getElementById("address_"+o.selectedAddressId);o.selectedAddress.name=t.dataset.name,o.selectedAddress.lat=t.dataset.lat,o.selectedAddress.lng=t.dataset.lng,o.finalLatLng.lat=t.dataset.lat,o.finalLatLng.lng=t.dataset.lng,google.maps.event.trigger(map,"resize"),o.map.setCenter(new google.maps.LatLng(o.finalLatLng.lat,o.finalLatLng.lng)),o.map.setZoom(14)},o.placeName="",o.placeNameSearchResults="",o.findByPlaceName=function(){t.get("api/find_location_by_place_name",{params:{lat:o.selectedAddress.lat,lng:o.selectedAddress.lng,placename:o.placeName}}).success(function(e){e.success?o.placeNameSearchResults=e.data.results:(alert("Something went Wrong, please login again.."),a.logout())}).error(function(e){alert("Something went Wrong, please login again..",e),a.logout()})},o.selectedPlaceName={},o.selectPlaceName=function(){var e=document.getElementById("place_"+o.selectedPlaceNameId);o.selectedPlaceName.name=e.dataset.name,o.selectedPlaceName.lat=e.dataset.lat,o.selectedPlaceName.lng=e.dataset.lng,o.finalLatLng.lat=e.dataset.lat,o.finalLatLng.lng=e.dataset.lng,google.maps.event.trigger(map,"resize"),o.map.setCenter(new google.maps.LatLng(o.finalLatLng.lat,o.finalLatLng.lng)),o.map.setZoom(16)},o.igShowDone=!1,o.confirm=function(){var e=o.finalLatLng.lat-o.centerLatLng.lat,n=o.finalLatLng.lng-o.centerLatLng.lng,l=n>=0?Math.atan(e/n):Math.PI+Math.atan(e/n),i=Math.sin(l),s=Math.cos(l),r=Date.now(),c=parseInt(r+Math.abs(e/i*1e5*1e3)),g={name:o.finalLatLng.name,igId:o.igNewPic.id,igImage:o.igNewPic.image,igLink:o.igNewPic.link,lat:o.centerLatLng.lat,lng:o.centerLatLng.lng,endLat:o.finalLatLng.lat,endLng:o.finalLatLng.lng,latVel:i,lngVel:s,created_at:r,arrived_at:c};t.post("api/balloons",g).success(function(e){e.success?(console.log(e.data),o.balloons.push(e.data),o.generateMarker(o.balloons[o.balloons.length-1]),o.map.setCenter(new google.maps.LatLng(e.data.lat,e.data.lng)),o.map.setZoom(12),o.igShowDone=!0):(alert("Something went Wrong, please login again.."),a.logout())}).error(function(e){alert("Something went Wrong, please login again..",e),a.logout()})},o.generateMarker=function(e){var t=new google.maps.Marker({position:new google.maps.LatLng(e.endLat,e.endLng),title:e.name,igId:e.igId,icon:new google.maps.MarkerImage(e.igImage,null,null,null,new google.maps.Size(50,50))});o.oms.addListener("click",function(e,t){o.igShow(e)}),o.oms.addListener("spiderfy",function(e,t){o.balloons.forEach(function(t){e.forEach(function(e){t.igId==e.igId&&(t.stop=!0)})})}),o.oms.addListener("unspiderfy",function(e,t){o.balloons.forEach(function(t){e.forEach(function(e){t.igId==e.igId&&(t.stop=!1)})})}),o.oms.addMarker(t),e.marker=t,e.marker.setMap(o.map)},o.balloons=[],o.centerLatLng={lat:34.05223,lng:-118.24368},document.querySelector("ig-show").className="hidden",document.querySelector("ig-new").className="hidden";var l=function(e,t,n){var a=new google.maps.StyledMapType([{featureType:"landscape",stylers:[{hue:"#FFBB00"},{saturation:43.400000000000006},{lightness:37.599999999999994},{gamma:1}]},{featureType:"road.highway",stylers:[{hue:"#FFC200"},{saturation:-61.8},{lightness:45.599999999999994},{gamma:1}]},{featureType:"road.arterial",stylers:[{hue:"#FF0300"},{saturation:-100},{lightness:51.19999999999999},{gamma:1}]},{featureType:"road.local",stylers:[{hue:"#FF0300"},{saturation:-100},{lightness:52},{gamma:1}]},{featureType:"water",stylers:[{hue:"#0078FF"},{saturation:-13.200000000000003},{lightness:2.4000000000000057},{gamma:1}]},{featureType:"poi",stylers:[{hue:"#00FF6A"},{saturation:-1.0989010989011234},{lightness:11.200000000000017},{gamma:1}]}],{name:"map_style"}),l={zoom:n,center:new google.maps.LatLng(e,t),mapTypeControlOptions:{mapTypeIds:[google.maps.MapTypeId.ROADMAP,"map_style"]}};o.map=new google.maps.Map(document.getElementById("map"),l),o.map.mapTypes.set("map_style",a),o.map.setMapTypeId("map_style"),o.oms=new OverlappingMarkerSpiderfier(o.map,{circleFootSeparation:46,spiralFootSeparation:52}),o.balloons.forEach(function(e){o.generateMarker(e)}),o.updateBalloons=setInterval(function(){var e=Date.now();o.balloons.forEach(function(t){var n=(t.created_at,t.arrived_at);!t.stop&&n>e&&(t.latVel>0&&t.endLat>t.lat?t.lat+=1e-5*t.latVel:t.latVel<0&&t.endLat<t.lat&&(t.lat+=1e-5*t.latVel),t.lngVel>0&&t.endLng>t.lng?t.lng+=1e-5*t.lngVel:t.lngVel<0&&t.endLng<t.lng&&(t.lng+=1e-5*t.lngVel),t.marker.setPosition(new google.maps.LatLng(t.lat,t.lng)))})},1e3)};t.get("api/balloons").success(function(e){console.log(e.data),e.success?(o.balloons=e.data,l(o.centerLatLng.lat,o.centerLatLng.lng,12)):(alert("Something went Wrong, please login again.."),a.logout())}).error(function(e){alert("Something went Wrong, please login again..",e),a.logout()}),e.$on("$destroy",function(){clearInterval(o.updateBalloons)})}angular.module("MapController",[]).controller("MapController",e),e.$inject=["$scope","$http","$window","Auth"]}(),function(){"use strict";function e(){return{restrict:"E",templateUrl:"directives/ig_show.html"}}function t(){return{restrict:"E",templateUrl:"directives/ig_new.html"}}angular.module("MapDirectives",[]).directive("igShow",e).directive("igNew",t)}(),function(){"use strict";function e(e,t){e.when("/",{templateUrl:"views/welcome.html",controller:"AppController",controllerAs:"appCtrl",requireLogin:!1}).when("/app",{templateUrl:"views/app.html",controller:"MapController",controllerAs:"mapCtrl",requireLogin:!0}).otherwise("/"),t.html5Mode(!0)}angular.module("app.routes",["ngRoute"]).config(e),e.$inject=["$routeProvider","$locationProvider"]}(),function(){"use strict";function e(e){e.interceptors.push("AuthInterceptor")}function t(e,t,n,a){e.$on("$locationChangeStart",function(e,o,l){for(var i in t.routes)-1!=o.indexOf(i)&&t.routes[i].requireLogin&&!a.isLoggedIn()&&(alert("Please login first :D"),e.preventDefault(),n.location.href="/")})}angular.module("iBalloon",["app.routes","ngCookies","AppController","MapController","AppService","AuthService","MapDirectives"]).config(e).run(t),e.$inject=["$httpProvider"],t.$inject=["$rootScope","$route","$window","Auth"]}();